{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Sanciones | TwoMove</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body { background-color: #f8f9fa; }
    .card { border-radius: 1rem; box-shadow: 0 0.5rem 1rem rgba(0,0,0,0.1); }
    .card-header { background-color: #dc3545; color: white; border-top-left-radius: 1rem; border-top-right-radius: 1rem; }
    .badge-activa { background-color: #dc3545; }
    .badge-inactiva { background-color: #6c757d; }
    .table th, .table td { vertical-align: middle; }
  </style>
</head>
<body>
  <div class="container py-5" style="max-width: 950px;">
    <div class="card">
      <div class="card-header text-center">
        <h4 class="mb-0">üö´ Gesti√≥n de Sanciones</h4>
      </div>
      <div class="card-body p-4">

        <!-- Mensajes del sistema -->
        {% if messages %}
          <div class="mb-3">
            {% for message in messages %}
              <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
                {{ message }}
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
              </div>
            {% endfor %}
          </div>
        {% endif %}

        <!-- Formulario de nueva sanci√≥n -->
        <form method="post" class="border rounded p-3 mb-4 bg-light">
          {% csrf_token %}
          <h5 class="mb-3">‚ûï Aplicar nueva sanci√≥n</h5>

          <div class="row g-3">
            <div class="col-md-4">
              <label class="form-label fw-semibold">Usuario</label>
              <select name="usuario_id" class="form-select" required>
                <option value="">-- Selecciona un usuario --</option>
                {% for u in usuarios %}
                  <option value="{{ u.usuario_id }}">{{ u.email }}</option>
                {% endfor %}
              </select>
            </div>
            <div class="col-md-4">
              <label class="form-label fw-semibold">Motivo</label>
              <select name="motivo" class="form-select" required>
                <option value="no_devolucion">No devolvi√≥ la bicicleta</option>
                <option value="da√±o_bicicleta">Da√±o al equipo</option>
                <option value="pago_pendiente">Pago pendiente</option>
                <option value="comportamiento">Comportamiento inapropiado</option>
                <option value="otros">Otros</option>
              </select>
            </div>
            <div class="col-md-4">
              <label class="form-label fw-semibold">Duraci√≥n (d√≠as)</label>
              <input type="number" name="dias" class="form-control" value="3" min="1" required>
            </div>
          </div>

          <div class="mt-3">
            <label class="form-label fw-semibold">Descripci√≥n</label>
            <textarea name="descripcion" class="form-control" rows="2" placeholder="Detalles adicionales (opcional)"></textarea>
          </div>

          <div class="mt-3 text-end">
            <button type="submit" class="btn btn-danger px-4">
              üö´ Aplicar sanci√≥n
            </button>
          </div>
        </form>

        <!-- Tabla de sanciones -->
        <h5 class="mb-3 mt-4">üìã Historial de sanciones</h5>
        <div class="table-responsive">
          <table class="table table-striped align-middle">
            <thead class="table-dark">
              <tr>
                <th>#</th>
                <th>Usuario</th>
                <th>Motivo</th>
                <th>Descripci√≥n</th>
                <th>Inicio</th>
                <th>Fin</th>
                <th>Estado</th>
                <th>Acci√≥n</th>
              </tr>
            </thead>
            <tbody>
              {% for s in sanciones %}
                <tr>
                  <td>{{ forloop.counter }}</td>
                  <td>{{ s.usuario.email }}</td>
                  <td>{{ s.get_motivo_display }}</td>
                  <td style="max-width: 200px;">{{ s.descripcion|default:"-" }}</td>
                  <td>{{ s.fecha_inicio|date:"d/m/Y H:i" }}</td>
                  <td>
                    {% if s.fecha_fin %}
                      {{ s.fecha_fin|date:"d/m/Y H:i" }}
                    {% else %}
                      -
                    {% endif %}
                  </td>
                  <td>
                    {% if s.activa %}
                      <span class="badge badge-activa">Activa</span>
                    {% else %}
                      <span class="badge badge-inactiva">Inactiva</span>
                    {% endif %}
                  </td>
                  <td>
                    {% if s.activa %}
                      <a href="{% url 'admin_dashboard:levantar_sancion' s.id %}" 
                         class="btn btn-sm btn-outline-success"
                         onclick="return confirm('¬øSeguro que deseas levantar esta sanci√≥n?')">
                        ‚úÖ Levantar
                      </a>
                    {% else %}
                      <span class="text-muted">‚Äî</span>
                    {% endif %}
                  </td>
                </tr>
              {% empty %}
                <tr>
                  <td colspan="8" class="text-center text-muted py-3">
                    No hay sanciones registradas.
                  </td>
                </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>

        <div class="mt-4 text-center">
          <a href="{% url 'admin_dashboard:dashboard_home' %}" class="btn btn-secondary">
            ‚¨ÖÔ∏è Volver al Dashboard
          </a>
        </div>

      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
