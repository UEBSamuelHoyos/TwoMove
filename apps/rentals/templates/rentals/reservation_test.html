{% load static %}
<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Reservar Bicicleta - TwoMove</title>
    <link rel="stylesheet" href="{% static 'rentals/css/reserve_bike.css' %}" />
  </head>
  <body>
    <!-- Sidebar -->
    <aside class="sidebar" id="sidebar">
      <div class="sidebar-header">
        <div class="logo-icon">
          <img
            src="{% static 'users/images/logo.png' %}"
            alt="TwoMove"
            onerror="this.style.display='none'; this.parentElement.innerHTML='<div style=\'width:45px;height:45px;background:#2cb5a0;border-radius:50%;display:flex;align-items:center;justify-content:center;color:white;font-size:1.5rem;font-weight:600;\'>T</div>'"
          />
        </div>
        <button class="close-sidebar" id="closeSidebar">âœ•</button>
      </div>

      <nav class="sidebar-nav">
        <a href="{% url 'users:dashboard' %}" class="nav-item">
          <span class="icon">ğŸ </span>
          <span>Inicio</span>
        </a>
        <a href="{% url 'menu_pagos' %}" class="nav-item">
          <span class="icon">ğŸ’³</span>
          <span>Saldo y Recargas</span>
        </a>
        <a href="{% url 'rentals:start_trip_test' %}" class="nav-item">
          <span class="icon">ğŸš´</span>
          <span>Mis Viajes</span>
        </a>
        <a href="{% url 'rentals:reservation_test' %}" class="nav-item">
          <span class="icon">ğŸ“…</span>
          <span>Reservar</span>
        </a>
        <a
          href="{% url 'rentals:cancel_reservation_test' %}"
          class="nav-item active"
        >
          <span class="icon">âŒ</span>
          <span>Cancelar Reserva</span>
        </a>
        <a href="{% url 'rentals:trip_history' %}" class="nav-item">
          <span class="icon">ğŸ“Š</span>
          <span>Historial</span>
        </a>
      </nav>

      <div class="sidebar-footer">
        <a href="{% url 'users:logout' %}" class="logout-btn">
          <span class="icon">ğŸšª</span>
          <span>Cerrar SesiÃ³n</span>
        </a>
      </div>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
      <header class="dashboard-header">
        <button class="menu-toggle" id="menuToggle">â˜°</button>
        <div class="header-right">
          <div class="user-info">
            <span class="user-name">{{ user.nombre|default:"Usuario" }}</span>
          </div>
        </div>
      </header>

      <div class="content-wrapper">
        <h1>Reservar Bicicleta ğŸš²</h1>
        <p class="subtitle">Planifica tu prÃ³ximo viaje en bicicleta</p>

        <!-- Alert Message -->
        <div
          id="alertMessage"
          class="alert-container"
          style="display: none"
        ></div>

        <!-- Saldo Disponible -->
        <div class="balance-banner">
          <div class="balance-info">
            <span class="balance-label">ğŸ’° Saldo Disponible</span>
            <span class="balance-value"
              >${{ user.wallet.balance|default:"0" }} COP</span
            >
          </div>
          <a href="{% url 'recargar_saldo' %}" class="btn-recharge-small">
            Recargar
          </a>
        </div>

        <!-- Formulario de Reserva -->
        <div class="reserve-container">
          <!-- Columna 1: Estaciones y Fecha -->
          <div class="reserve-card">
            <div class="card-header">
              <span class="header-icon">ğŸ“</span>
              <h3>Ruta y Horario</h3>
            </div>

            <div class="form-group">
              <label for="estacionOrigen">
                <span class="label-icon">ğŸ”µ</span>
                EstaciÃ³n de Origen
              </label>
              <select id="estacionOrigen" class="form-select">
                <option value="">Cargando estaciones...</option>
              </select>
              <p class="helper-text">Selecciona dÃ³nde recogerÃ¡s la bicicleta</p>
            </div>

            <div class="form-group">
              <label for="estacionDestino">
                <span class="label-icon">ğŸ”´</span>
                EstaciÃ³n de Destino
              </label>
              <select id="estacionDestino" class="form-select">
                <option value="">Cargando estaciones...</option>
              </select>
              <p class="helper-text">
                Selecciona dÃ³nde devolverÃ¡s la bicicleta
              </p>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label for="fechaReserva">
                  <span class="label-icon">ğŸ“…</span>
                  Fecha
                </label>
                <input type="date" id="fechaReserva" class="form-input" />
              </div>
              <div class="form-group">
                <label for="horaReserva">
                  <span class="label-icon">â°</span>
                  Hora
                </label>
                <input type="time" id="horaReserva" class="form-input" />
              </div>
            </div>
          </div>

          <!-- Columna 2: Tipo de Bici y Pago -->
          <div class="reserve-card">
            <div class="card-header">
              <span class="header-icon">ğŸš´</span>
              <h3>Preferencias</h3>
            </div>

            <div class="form-group">
              <label for="tipoBicicleta">
                <span class="label-icon">âš¡</span>
                Tipo de Bicicleta
              </label>
              <div class="bike-type-selector">
                <div class="bike-option" data-value="electric">
                  <div class="bike-icon">âš¡</div>
                  <div class="bike-info">
                    <h4>ElÃ©ctrica</h4>
                    <p>MÃ¡s rÃ¡pida y cÃ³moda</p>
                  </div>
                  <input
                    type="radio"
                    name="tipoBicicleta"
                    value="electric"
                    checked
                  />
                </div>
                <div class="bike-option" data-value="manual">
                  <div class="bike-icon">ğŸš´</div>
                  <div class="bike-info">
                    <h4>Convencional</h4>
                    <p>Ejercicio tradicional</p>
                  </div>
                  <input type="radio" name="tipoBicicleta" value="manual" />
                </div>
              </div>
            </div>

            <div class="form-group">
              <label for="tipoViaje">
                <span class="label-icon">ğŸ›£ï¸</span>
                Tipo de Viaje
              </label>
              <select id="tipoViaje" class="form-select">
                <option value="ultima_milla">Ãšltima Milla (45 min mÃ¡x)</option>
                <option value="recorrido_largo">
                  Recorrido Largo (75 min mÃ¡x)
                </option>
              </select>
              <p class="helper-text">El tiempo determina el costo del viaje</p>
            </div>

            <div class="form-group">
              <label for="metodoPago">
                <span class="label-icon">ğŸ’³</span>
                MÃ©todo de Pago
              </label>
              <select id="metodoPago" class="form-select">
                <option value="wallet">ğŸ’° Saldo en App</option>
                <option value="card">ğŸ’³ Tarjeta de CrÃ©dito</option>
              </select>
            </div>
          </div>
        </div>

        <!-- Resumen de Reserva -->
        <div class="summary-card" id="summaryCard" style="display: none">
          <div class="card-header">
            <span class="header-icon">ğŸ“‹</span>
            <h3>Resumen de tu Reserva</h3>
          </div>
          <div class="summary-content">
            <div class="summary-row">
              <span>ğŸ”µ Origen:</span>
              <strong id="summaryOrigen">-</strong>
            </div>
            <div class="summary-row">
              <span>ğŸ”´ Destino:</span>
              <strong id="summaryDestino">-</strong>
            </div>
            <div class="summary-row">
              <span>ğŸ“… Fecha y Hora:</span>
              <strong id="summaryFechaHora">-</strong>
            </div>
            <div class="summary-row">
              <span>ğŸš´ Tipo de Bicicleta:</span>
              <strong id="summaryBici">-</strong>
            </div>
            <div class="summary-row">
              <span>ğŸ›£ï¸ Tipo de Viaje:</span>
              <strong id="summaryTipoViaje">-</strong>
            </div>
            <div class="summary-row highlight">
              <span>ğŸ’° Costo Estimado:</span>
              <strong id="summaryCosto">Calculando...</strong>
            </div>
          </div>
        </div>

        <!-- BotÃ³n de Reservar -->
        <div class="action-section">
          <button id="btnReservar" class="btn-reserve">
            <span class="btn-icon">âœ…</span>
            Confirmar Reserva
          </button>
        </div>

        <!-- Info Cards -->
        <div class="info-cards">
          <div class="info-card">
            <span class="info-icon">â±ï¸</span>
            <div>
              <h4>Tiempos de Viaje</h4>
              <p>
                <strong>Ãšltima Milla:</strong> Hasta 45 minutos<br />
                <strong>Recorrido Largo:</strong> Hasta 75 minutos
              </p>
            </div>
          </div>
          <div class="info-card">
            <span class="info-icon">ğŸ’¡</span>
            <div>
              <h4>Consejo</h4>
              <p>
                Reserva con anticipaciÃ³n para asegurar disponibilidad en las
                estaciones mÃ¡s concurridas.
              </p>
            </div>
          </div>
        </div>
      </div>
    </main>

    <!-- Modal de ConfirmaciÃ³n -->
    <div id="confirmModal" class="modal" style="display: none">
      <div class="modal-content">
        <div class="modal-header">
          <h3>âœ… Reserva Confirmada</h3>
          <button class="modal-close" id="modalClose">âœ•</button>
        </div>
        <div class="modal-body" id="modalBody">
          <!-- Contenido dinÃ¡mico -->
        </div>
        <div class="modal-footer">
          <button class="btn-primary" id="btnVerReservas">
            Ver Mis Reservas
          </button>
          <button class="btn-secondary" id="btnNuevaReserva">
            Nueva Reserva
          </button>
        </div>
      </div>
    </div>

    <script src="{% static 'rentals/js/reserve_bike.js' %}"></script>
  </body>
</html>
